var page=1;var nick_g="",search_g="",global_g=false,interval;window.onhashchange=checkHash(true);$(document).ready(function(){open();handleHash();sortComments();$("#more_twibbs").click(function(){checkHash();load_dips(global_g,nick_g,search_g)});$(".twibb").live("mouseover mouseout",function(b){var a=this.children[3];if(b.type=="mouseover"){$(a).show()}if(b.type=="mouseout"){$(a).hide()}});$("#logo > a > img").click(function(){dyn_get(true,true)});$(".comment_link").live("click",function(){var a=$(this).parents()[1].id;$("#to_id").val(a);$("#in_comment_to").html("in reply to: <a href='#' class='reply_to_link'>"+a+"</a> <a href='#' class='remove'>X</a>").show();$("#input_text").focus()});$(".reply_to_link").live("click",function(){var a="#"+parseInt($(this).text());$(a).css("border","5px solid yellow");setTimeout(function(){$(a).css("border")},5000)});$(".remove").live("click",function(){$(this.parentElement).html("");$("#to_id").val("")});$("#refresh").click(function(){if($(this).hasClass("stop")){window.clearInterval(interval);$(this).addClass("start").removeClass("stop").text("Aktuallisieren fortsetzen");return}$(this).addClass("stop").removeClass("start").text("Aktuallisieren stoppen");handleHash()});$("#twibber_it").click(function(){dyn_submit()})});$("#input_text").NobleCount("#counter",{on_negative:function(a,b,d,c){b.css("color","red")},on_positive:function(a,b,d,c){b.css("color","green")},max_chars:250,on_update:function(a,b,d,c){if(c<=10){b.css("color","red")}}});function dyn_get(b,d,a,c){if(d){$.get("api.php",{dyn_get:1,latest:b,page:page},function(e){$("#twibber").html(e);sortComments()});return false}if(a!=""){$.get("api.php",{nick:a,latest:b,page:page},function(e){$("#twibber").html(e);sortComments()});return false}if(c!=""){$.get("api.php",{search:c,latest:b,page:page},function(e){$("#twibber").html(e);sortComments()});return false}return true}function dyn_submit(){var d=$("#input_text").val();var b="api.php?new_entry=1";var c=$("#to_id").val();var a={text:d};if(c!=""){b="api.php?new_entry=1&comment=1";a={text:d,to_id:c}}if(d.replace(/^\s+|\s+$/g,"")!=""&&d.length<=250&&$("#nickname").val()!=""){$.post(b,a,function(e){dyn_get(true,true);$("#status").freeow(e,e.replace("!","")+" gesendet!",{classes:["smokey"],autoHideDelay:2500})});$("#input_text").val("");$("#counter").text("250");$("#in_reply_to").html("")}else{alert("Error! Nachricht zu lang, keine Nachricht vorhanden oder kein Nickname eingegeben.")}}function insert_nick(a){$("#input_text").focus();$("#input_text").val("@"+a+" "+$("#input_text").val())}function open(){$("#open").click(function(){$("#panel").slideDown("slow").delay(1).css("display","block")});$("#close").click(function(){$("#panel").slideUp("slow")});$("#toggle a").click(function(){$("#toggle a").toggle()})}function load_dips(c,a,b){page++;$("#status").freeow("Loading","Mehr Twibbs werden geladen!",{classes:["smokey"],autoHideDelay:2500});dyn_get(false,c,a,b)}function handleHash(){if(interval!=undefined){window.clearInterval(interval)}var a=checkHash();switch(a[0]){case"nick":$("#status").freeow("Loading","Twibbs von "+a[1]+" werden geladen",{classes:["smokey"],autoHideDelay:1500});dyn_get(true,false,a[1]);break;case"search":$("#status").freeow("Loading","Twibbs werden gesucht ("+a[1]+")",{classes:["smokey"],autoHideDelay:1500});dyn_get(true,false,"",a[1]);break;default:interval=window.setInterval("dyn_get(true, true)",20000);break}}function checkHash(a){reset_vars();if(a){handleHash()}var b=location.hash.replace("#","");b=b.split("=");switch(b[0]){case"nick":nick_g=b[1];break;case"search":search_g=b[1];break;default:global_g=true;break}return b}function reset_vars(){search_g="";global_g=false;nick_g=""}function sortComments(){$.each($("#twibber").children(),function(a,c){var b=$(c).attr("to_id");if(b!=""){$("#"+b).append(c)}})};